name = "austinrifleclub-api"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# D1 Database binding
# Create with: wrangler d1 create austinrifleclub-db
# Then update the database_id below with the output
[[d1_databases]]
binding = "DB"
database_name = "austinrifleclub-db"
database_id = ""  # Set via: wrangler d1 create austinrifleclub-db

# KV Namespace binding (for rate limiting and caching)
# Create with: wrangler kv:namespace create KV
# Then update the id below with the output
[[kv_namespaces]]
binding = "KV"
id = ""  # Set via: wrangler kv:namespace create KV

# R2 Bucket binding (for file storage)
[[r2_buckets]]
binding = "R2"
bucket_name = "austinrifleclub-files"

# Development environment variables
# Sensitive secrets (BETTER_AUTH_SECRET, STRIPE_*, etc.) go in .dev.vars
[vars]
# These are overridden in .dev.vars for local development
BETTER_AUTH_URL = "http://localhost:8787"
CORS_ALLOWED_ORIGINS = "http://localhost:4321,http://localhost:3000"
PUBLIC_URL = "http://localhost:4321"
FROM_EMAIL = "Austin Rifle Club <noreply@austinrifleclub.org>"
ADMIN_EMAIL = "admin@austinrifleclub.org"

# Local development settings
[dev]
port = 8787
local_protocol = "http"

# =============================================================================
# PRODUCTION ENVIRONMENT
# =============================================================================
[env.production]
name = "austinrifleclub-api"
workers_dev = false
routes = [
  { pattern = "austinrifleclub.org/api/*", zone_name = "austinrifleclub.org" },
  { pattern = "austinrifleclub.org/health/*", zone_name = "austinrifleclub.org" }
]

# Production D1 Database
# Set via Cloudflare dashboard or wrangler CLI
[[env.production.d1_databases]]
binding = "DB"
database_name = "austinrifleclub-db-prod"
database_id = ""  # Set in Cloudflare dashboard

# Production KV Namespace
# Set via Cloudflare dashboard or wrangler CLI
[[env.production.kv_namespaces]]
binding = "KV"
id = ""  # Set in Cloudflare dashboard

# Production R2 Bucket
[[env.production.r2_buckets]]
binding = "R2"
bucket_name = "austinrifleclub-files-prod"

[env.production.vars]
BETTER_AUTH_URL = "https://austinrifleclub.org"
CORS_ALLOWED_ORIGINS = "https://austinrifleclub.org,https://www.austinrifleclub.org"
PUBLIC_URL = "https://austinrifleclub.org"
FROM_EMAIL = "Austin Rifle Club <noreply@austinrifleclub.org>"
ADMIN_EMAIL = "membership@austinrifleclub.org"
# FROM_PHONE must be set via wrangler secret or dashboard

# =============================================================================
# STAGING ENVIRONMENT
# =============================================================================
[env.staging]
name = "austinrifleclub-api-staging"
workers_dev = true

# Staging D1 Database
# Set via Cloudflare dashboard or wrangler CLI
[[env.staging.d1_databases]]
binding = "DB"
database_name = "austinrifleclub-db-staging"
database_id = ""  # Set in Cloudflare dashboard

# Staging KV Namespace
# Set via Cloudflare dashboard or wrangler CLI
[[env.staging.kv_namespaces]]
binding = "KV"
id = ""  # Set in Cloudflare dashboard

# Staging R2 Bucket
[[env.staging.r2_buckets]]
binding = "R2"
bucket_name = "austinrifleclub-files-staging"

[env.staging.vars]
BETTER_AUTH_URL = "https://staging.austinrifleclub.org"
CORS_ALLOWED_ORIGINS = "https://staging.austinrifleclub.org"
PUBLIC_URL = "https://staging.austinrifleclub.org"
FROM_EMAIL = "Austin Rifle Club <noreply@austinrifleclub.org>"
ADMIN_EMAIL = "membership@austinrifleclub.org"
# FROM_PHONE must be set via wrangler secret or dashboard
